# Обогащение файлов конфигурации

## Информация

При запросе файлов с сервера, тело файла проходит несколько этапов наполнения данными и трансформацию через `handlebars`.
Переменные сервера загружаются из источников указанных в секции файла настроек **store.keys**. Переменные пространства имён загружаются из источников указанных в ключе **keys** настройки пространства.

В запрашиваемых файлах переменные указываются между скобками **<<** и **>>**, если переменные имеют сложный путь, то вложенность обозначаются точкой. Серверные переменные имеют префикс **server.** и имени файла без расширения, переменные с префиксом пространства имён и имени файла без расширения, имеют префикс равный имени пространства, например: переменные пространства **git1** имеют префикс `git1.`. Значения ключей в файлах перемененных могут быть числом, строкой, объектом, массивом или логическое значение, так же можно как значение указать имя переменой операционной системы. Имена ключей ключей должны соответсвовать регулярному выражению **^[a-zA-Z]{1}[-a-zA-Z0-9_]{0,31}$** Файл перемененных может быть двух типов **json** или **toml**.

### пример файла перемененных
```js
{
    "key1": "key1-val",
    "key2": 123,
    "key3": false,
    "key4": {
        "sub-key1": 123
    },
    "key5": [],
    "key6": "${ENV_NAME}"
}
```

## Этапы наполнения

- Наполнения перемененными пространства имён.
- Наполнения перемененными сервера и пространства имён с префиксом.
- Применение шаблонизатора `handlebars` [подробно](https://handlebarsjs.com/)

## Пример обогащения файла

### исходный файл config.toml

```toml
key1 = "<<server.key1>>"
key2 = "<<git1.key2>>"
{{#if git1.keys.key1}}
key3 = 1
{{/if}}
{{#if git1.keys.key2}}
key3 = 2
{{/if}}
key4 = "{{key1}}"
```

### результирующий список переменных

```js
{
    "server.key1": "server-key1",
    "git1.key2": "git1-key2",
    "git1.keys.key1": "git1-keys-key1",
    "git1.key1": "git1-key1",
}
```

### результирующий файл config.toml

```toml
key1 = "server-key1"
key2 = "git1-key2"
key3 = 1
key4 = "git1-key1"
```
